#!/usr/bin/env python3
"""Get daily quota usage from Trinity website."""
import argparse
import requests
from lxml import html


def main():
    """Grab and sum the numbers."""
    parser = argparse.ArgumentParser(description=__doc__)
    parser.add_argument("session_url", type=str,
                        help="Session URL for daily summary.")
    args = parser.parse_args()

    page = requests.get(args.session_url)
    tree = html.fromstring(page.content)
    center = tree.xpath('//*[@id="mainbody"]/table/tr[2]/td/form/center')[0]
    tables = center.findall('table')
    received = 0
    sent = 0
    total = 0

    def parse_cell(text):
        return int(text.replace(',', ''))

    for table in tables[1:]:
        received += parse_cell(table.xpath('tr[2]/td[1]')[0].text)
        sent += parse_cell(table.xpath('tr[2]/td[2]')[0].text)
        total += parse_cell(table.xpath('tr[2]/td[3]')[0].text)

    print("{:>8s} {:>8s} {:>8s}".format("Received", "Sent", "Total"))
    print("{:8d} {:8d} {:8d}".format(received, sent, total))

if __name__ == "__main__":
    main()
