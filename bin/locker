#!/bin/bash
set -e

base05="d8d8d8"
base08="ab4642"
base0A="f7ca88"
base0B="a1b56c"

OPTS=(
    --nofork
    --ignore-empty-password
    --show-failed-attempts
    --image="$HOME/.i3lockbg"
)
# Extra options for i3lock-color
(which pacman >/dev/null 2>&1) &&
    [[ $(pacman -Qqo i3lock) =~ ^i3lock-color ]] &&
    OPTS+=(
        --insidevercolor="$base0A"40
        --insidewrongcolor="$base08"40
        --insidecolor="$base05"10
        --ringvercolor="$base0A"ff
        --ringwrongcolor="$base08"ff
        --ringcolor="$base05"ff
        --line-uses-inside
        --separatorcolor="$base05"ff
        --keyhlcolor="$base0B"ff
        --bshlcolor="$base08"ff
        --verifcolor="$base05"ff
        --wrongcolor="$base05"ff
        --timecolor="$base05"ff
        --datecolor="$base05"ff
        --verif-font=mono
        --wrong-font=mono
        --time-font=mono
        --date-font=mono
        --veriftext=
        --wrongtext=
        --timesize=24
        --datesize=16
        --radius=128
        --ring-width=4
        --indicator
        --clock
        --datepos='tx:ty+20'
        --datestr='%a %e %b %Y'
    )

# Turn off the screen, if 'off' is given
[ "$1" = "off" ] && (sleep 2 && xset dpms force off) &

# Non-forking as a new countdown starts as soon as the locker exits
i3lock "${OPTS[@]}"
