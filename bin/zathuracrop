#!/bin/bash

usage() {
    echo "usage: $0 PDF" >&2 && exit
}
[[ "$#" -eq 1 ]] || usage
PDF="$1"

RIGHT="$(pdfinfo -box "$PDF" | grep -E "^MediaBox:" | awk '{print $4;}')"
BBOX="$(gs -dSAFER -dBATCH -dNOPAUSE -dQUIET -sDEVICE=bbox "$PDF" 2>&1 |
    grep -E "^%%BoundingBox:")"
BOT="$(echo "$BBOX" | awk '{print $3;}' | sort -n | head -1)"
TOP="$(echo "$BBOX" | awk '{print $5;}' | sort -n | tail -1)"

CROP="$(mktemp --tmpdir --suffix=."$(basename "$PDF")" zathuracrop.XXXXXXXX)"
pdfcrop --bbox "0 $BOT $RIGHT $TOP" "$PDF" "$CROP"

zathura --fork "$CROP"
